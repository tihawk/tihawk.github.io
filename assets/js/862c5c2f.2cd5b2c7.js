"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[465],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},b=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(n),b=r,d=u["".concat(c,".").concat(b)]||u[b]||h[b]||i;return n?a.createElement(d,o(o({ref:t},p),{},{components:n})):a.createElement(d,o({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=b;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[u]="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},7604:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7294);const r={"donate-card":"donate-card_mbts",bmac:"bmac_qmhE"};function i(){return a.createElement("div",{className:"alert alert--primary",role:"alert"},a.createElement("div",{className:"card__body"},a.createElement("p",null,"Thank you for reading!"),a.createElement("p",null,"The information in this blog, as well as all the tools, apps and libraries I develop are currently open source."),a.createElement("p",null,"I would love to keep it this way, and you can help!"),a.createElement("p",null,"You can buy me a coffee from here, which will go towards the next all-nighter I pull off!"),a.createElement("a",{href:"https://www.buymeacoffee.com/kblagoev",target:"_blank"},a.createElement("img",{src:"https://cdn.buymeacoffee.com/buttons/v2/default-violet.png",className:r.bmac,alt:"Buy Me A Coffee"})),a.createElement("p",null,"Or you can support me and my code monthly over at ",a.createElement("a",{href:"https://github.com/sponsors/tihawk",target:"_blank"},"Github Sponsors!")),a.createElement("p",null,"Thanks!")))}},4781:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>b,frontMatter:()=>o,metadata:()=>c,toc:()=>p});var a=n(7462),r=(n(7294),n(3905)),i=n(7604);const o={slug:"authenticator-cyberapocalypse-2021-ctf",title:"Authenticator - Cyberapocalypse 2021 CTF",description:"This is a writeup for the Authenticator challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Reverse.",authors:"kiroki",tags:["Cyber Security","CTF"]},l=void 0,c={permalink:"/blog/authenticator-cyberapocalypse-2021-ctf",source:"@site/blog/2021-04-29-19:06:47authenticator-cyberapocalypse-2021-ctf.md",title:"Authenticator - Cyberapocalypse 2021 CTF",description:"This is a writeup for the Authenticator challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Reverse.",date:"2021-04-29T00:00:00.000Z",formattedDate:"April 29, 2021",tags:[{label:"Cyber Security",permalink:"/blog/tags/cyber-security"},{label:"CTF",permalink:"/blog/tags/ctf"}],readingTime:4.6,hasTruncateMarker:!0,authors:[{name:"Kiril Panayotov Blagoev",title:"Admin",url:"https://github.com/tihawk",imageURL:"https://github.com/tihawk.png",key:"kiroki"}],frontMatter:{slug:"authenticator-cyberapocalypse-2021-ctf",title:"Authenticator - Cyberapocalypse 2021 CTF",description:"This is a writeup for the Authenticator challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Reverse.",authors:"kiroki",tags:["Cyber Security","CTF"]},prevItem:{title:"Alien Camp - Cyberapocalypse 2021 CTF",permalink:"/blog/alien-camp-cyberapocalypse-2021-ctf"},nextItem:{title:"Passphrase - Cyberapocalypse 2021 CTF",permalink:"/blog/passphrase-cyberapocalypse-2021-ctf"}},s={authorsImageUrls:[void 0]},p=[{value:"Prompt",id:"prompt",level:3},{value:"Recon",id:"recon",level:3}],u={toc:p},h="wrapper";function b(e){let{components:t,...n}=e;return(0,r.kt)(h,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This is a writeup for the Authenticator challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Reverse."),(0,r.kt)("h3",{id:"prompt"},"Prompt"),(0,r.kt)("p",null,"We managed to steal one of the extraterrestrials' authenticator device. If we manage to understand how it works and get their credentials, we may be able to bypass all of their security locked doors and gain access everywhere!"),(0,r.kt)("h3",{id:"recon"},"Recon"),(0,r.kt)("p",null,"We're given a binary executable called authenticator with the following properties:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"file authenticator\nauthenticator: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=66286657ca5a06147189b419238b2971b11c72db, not stripped\n")),(0,r.kt)("p",null,"My favourite way to get an initial idea about a ",(0,r.kt)("em",{parentName:"p"},"not stripped")," binary is to run  ",(0,r.kt)("inlineCode",{parentName:"p"},"strings")," on it. It might not get you everything you need, but it does give you a very good idea of what you're up against. So, running strings on ",(0,r.kt)("inlineCode",{parentName:"p"},"authenticator"),", we get a bit of nonsense, and a few very interesting things:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'strings authenticator\n...[omitted for brevity]\n}a:Vh|}a:g}8j=}89gV<p<}:dV8<Vg9}V<9V<:j|{:\nAuthentication System \nPlease enter your credentials to continue.\nAlien ID: \n11337\nAccess Denied!\nPin: \nAccess Granted! Submit pin in the flag format: CHTB{fl4g_h3r3}\n;*3$"\n...[omitted for brevity]\n')),(0,r.kt)("p",null,"Well fun, let's run the binary and see if this is useful."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"./authenticator\n\nAuthentication System \ud83d\udc7d\n\nPlease enter your credentials to continue.\n\nAlien ID: 11337\nPin: \n")),(0,r.kt)("p",null,"Wouldn't you know it, the Alien ID value is what we saw in strings. Sadly, with the Pin we won't be so lucky. I did have a feeling that it will have something to do with that weird string ",(0,r.kt)("inlineCode",{parentName:"p"},"}a:Vh|}a:g}8j=}89gV<p<}:dV8<Vg9}V<9V<:j|{:"),", but we don't know anything about it yet."),(0,r.kt)("p",null,"So, let's open the binary in Ghidra, and check if we can find something in there. We can check out the decompiled ",(0,r.kt)("inlineCode",{parentName:"p"},"main")," function first"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},'undefined8 main(void)\n\n{\n  int iVar1;\n  undefined8 uVar2;\n  long in_FS_OFFSET;\n  undefined auStack88 [32];\n  undefined auStack56 [40];\n  long lStack16;\n  \n  lStack16 = *(long *)(in_FS_OFFSET + 0x28);\n  setbuf(stdout,0);\n  printstr(&DAT_00100bc3,0);\n  printstr(&DAT_00100be8,0);\n  printstr(&DAT_00100c15,0);\n  fgets(auStack88,0x20,stdin);\n  iVar1 = strcmp(auStack88,"11337\\n");\n  if (iVar1 == 0) {\n    printstr("Pin: ",0);\n    fgets(auStack56,0x20,stdin);\n    iVar1 = checkpin(auStack56);\n    if (iVar1 == 0) {\n      printstr("Access Granted! Submit pin in the flag format: CHTB{fl4g_h3r3}\\n",0);\n    }\n    else {\n      printstr("Access Denied!\\n",1);\n    }\n  }\n  else {\n    printstr("Access Denied!\\n",1);\n  }\n  uVar2 = 0;\n  if (lStack16 != *(long *)(in_FS_OFFSET + 0x28)) {\n    uVar2 = __stack_chk_fail();\n  }\n  return uVar2;\n}\n')),(0,r.kt)("p",null,"We can see the ",(0,r.kt)("inlineCode",{parentName:"p"},"strcmp")," function being called, which checks if our Alien ID input (stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"auStack88"),") is ",(0,r.kt)("inlineCode",{parentName:"p"},'"11337"'),"."),(0,r.kt)("p",null,"More importantly though, a few lines down we call a function called ",(0,r.kt)("inlineCode",{parentName:"p"},"checkpin"),"  with our input as a param. This is where the magic will presumably happen, so let's check it out."),(0,r.kt)("p",null,"undefined8 checkpin(long param_1)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c"},"undefined8 checkpin(long param_1)\n\n{\n  long lVar1;\n  int iStack36;\n  \n  iStack36 = 0;\n  while( true ) {\n    lVar1 = func_0x00100750(param_1);\n    if (lVar1 - 1U <= (ulong)(long)iStack36) {\n      return 0;\n    }\n    if (((&UNK_00100b98)[iStack36] ^ 9) != *(byte *)(param_1 + iStack36)) break;\n    iStack36 = iStack36 + 1;\n  }\n  return 1;\n}\n")),(0,r.kt)("p",null,"Long story short, what this function does is XOR some variable stored in  ",(0,r.kt)("inlineCode",{parentName:"p"},"&UNK_00100b98")," byte by byte with a hex value ",(0,r.kt)("inlineCode",{parentName:"p"},"9"),", and compare it (byte by byte) with our input. And lo and behold, that variable is indeed our weird string we found using strings!"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"        00100b98 7d              ??         7Dh    }\n        00100b99 61              ??         61h    a\n        00100b9a 3a              ??         3Ah    :\n        00100b9b 56              ??         56h    V\n        00100b9c 68              ??         68h    h\n        00100b9d 7c              ??         7Ch    |\n        00100b9e 7d              ??         7Dh    }\n        00100b9f 61              ??         61h    a\n        00100ba0 3a              ??         3Ah    :\n        00100ba1 67              ??         67h    g\n        00100ba2 7d              ??         7Dh    }\n        00100ba3 38              ??         38h    8\n        00100ba4 6a              ??         6Ah    j\n        00100ba5 3d              ??         3Dh    =\n        00100ba6 7d              ??         7Dh    }\n        00100ba7 38              ??         38h    8\n        00100ba8 39              ??         39h    9\n        00100ba9 67              ??         67h    g\n        00100baa 56              ??         56h    V\n        00100bab 3c              ??         3Ch    <\n        00100bac 70              ??         70h    p\n        00100bad 3c              ??         3Ch    <\n        00100bae 7d              ??         7Dh    }\n        00100baf 3a              ??         3Ah    :\n        00100bb0 64              ??         64h    d\n        00100bb1 56              ??         56h    V\n        00100bb2 38              ??         38h    8\n        00100bb3 3c              ??         3Ch    <\n        00100bb4 56              ??         56h    V\n        00100bb5 67              ??         67h    g\n        00100bb6 39              ??         39h    9\n        00100bb7 7d              ??         7Dh    }\n        00100bb8 56              ??         56h    V\n        00100bb9 3c              ??         3Ch    <\n        00100bba 39              ??         39h    9\n        00100bbb 56              ??         56h    V\n        00100bbc 3c              ??         3Ch    <\n        00100bbd 3a              ??         3Ah    :\n        00100bbe 6a              ??         6Ah    j\n        00100bbf 7c              ??         7Ch    |\n        00100bc0 7b              ??         7Bh    {\n        00100bc1 3a              ??         3Ah    :\n")),(0,r.kt)("p",null,"So, we knew the pin already, just didn't know we had to XOR it to decypher it. Let's do that! I'm gonna use a python script I wrote for the crypto challenges to XOR my own strings"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"#!/usr/bin/env python3\n\nciphertext1 = '9'\n\nciphertext2 = b'}a:Vh|}a:g}8j=}89gV<p<}:dV8<Vg9}V<9V<:j|{:'.hex()\n\ndef xor(hex1, hex2, getAscii = False):\n  result = []\n\n  for ind in range(0, len(hex1), 2):\n    longIndex = ind\n    shortIndex = ind%len(hex2)\n    hexChar1 = hex1[longIndex:longIndex+2]\n    byte1 = int(hexChar1, 16)\n\n    hexChar2 = hex2[shortIndex:shortIndex+2]\n    byte2 = int(hexChar2, 16)\n\n    asciiNum = byte1 ^ byte2\n    result.append(chr(asciiNum))\n\n\n  out = ''.join(result)\n  if getAscii:\n    print('Result:', out)\n    return out\n  else:\n    out = out.encode('utf-8').hex()\n    print('Result:', out)\n    return out\n\nxored = xor(ciphertext2, ciphertext1, True)\n")),(0,r.kt)("p",null,"And we get our Pin to be"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"th3_auth3nt1c4t10n_5y5t3m_15_n0t_50_53cur3\n")),(0,r.kt)("p",null,"So, now we can run ",(0,r.kt)("inlineCode",{parentName:"p"},"authenticator")," once again, and supply it with the Pin, to learn that we already have tha flag:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"./authenticator\n\nAuthentication System \ud83d\udc7d\n\nPlease enter your credentials to continue.\n\nAlien ID: 11337\nPin: th3_auth3nt1c4t10n_5y5t3m_15_n0t_50_53cur3\nAccess Granted! Submit pin in the flag format: CHTB{fl4g_h3r3}\n")),(0,r.kt)("p",null,"Flag:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"CHTB{th3_auth3nt1c4t10n_5y5t3m_15_n0t_50_53cur3}\n")),(0,r.kt)(i.Z,{mdxType:"DonateCard"}))}b.isMDXComponent=!0}}]);