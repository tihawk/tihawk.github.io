"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1979],{2414:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>h});var a=n(4848),r=n(8453),l=n(2714);const s={slug:"ministrypalace-cyberapocalypse-2021-ctf",title:"miniSTRypalace - Cyberapocalypse 2021 CTF",description:"This is a writeup for the miniSTRypalace challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Web.",authors:"kiroki",tags:["Cyber Security","CTF"]},i=void 0,o={permalink:"/blog/ministrypalace-cyberapocalypse-2021-ctf",source:"@site/blog/2021-04-29-21:27:49ministrypalace-cyberapocalypse-2021-ctf.md",title:"miniSTRypalace - Cyberapocalypse 2021 CTF",description:"This is a writeup for the miniSTRypalace challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Web.",date:"2021-04-29T00:00:00.000Z",formattedDate:"April 29, 2021",tags:[{label:"Cyber Security",permalink:"/blog/tags/cyber-security"},{label:"CTF",permalink:"/blog/tags/ctf"}],readingTime:1.605,hasTruncateMarker:!0,authors:[{name:"Kiril Panayotov Blagoev",title:"Admin",url:"https://github.com/tihawk",imageURL:"https://github.com/tihawk.png",key:"kiroki"}],frontMatter:{slug:"ministrypalace-cyberapocalypse-2021-ctf",title:"miniSTRypalace - Cyberapocalypse 2021 CTF",description:"This is a writeup for the miniSTRypalace challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Web.",authors:"kiroki",tags:["Cyber Security","CTF"]},unlisted:!1,prevItem:{title:"Inspector Gadget - Cyberapocalypse 2021 CTF",permalink:"/blog/inspector-gadget-cyberapocalypse-2021-ctf"},nextItem:{title:"E.Tree - Cyberapocalypse 2021 CTF",permalink:"/blog/e-tree-cyberapocalypse-2021-ctf"}},c={authorsImageUrls:[void 0]},h=[{value:"Prompt",id:"prompt",level:3},{value:"Recon",id:"recon",level:3},{value:"Analysis",id:"analysis",level:3},{value:"Solution",id:"solution",level:3}];function p(e){const t={code:"code",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"This is a writeup for the miniSTRypalace challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Web."}),"\n",(0,a.jsx)(t.h3,{id:"prompt",children:"Prompt"}),"\n",(0,a.jsx)(t.p,{children:"Let\u2019s read this website in the language of Alines. Or maybe not?"}),"\n",(0,a.jsx)(t.h3,{id:"recon",children:"Recon"}),"\n",(0,a.jsx)(t.p,{children:"We get the source code for a website, and we're informed by a docker environment setup, that the flag will be at the root of the system."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"# Dockerfile\n[redacted]\n\n# Copy challenge files\nCOPY challenge /www\nCOPY flag /\n\n[redacted]\n"})}),"\n",(0,a.jsxs)(t.p,{children:["From the source code, we can see that this is a PHP application, and we can inspect the ",(0,a.jsx)(t.code,{children:"index.php"})," file."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"<html>\n    <header>\n        <meta name='author' content='bertolis, makelaris'>\n        <title>Ministry of Defence</title>\n        <link rel=\"stylesheet\" href=\"/static/css/main.css\">\n        <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/slate/bootstrap.min.css\"   >\n    </header>\n\n    <body>\n    <div class=\"language\">\n        <a href=\"?lang=en.php\">EN</a>\n        <a href=\"?lang=qw.php\">QW</a>\n    </div>\n\n    <?php\n    $lang = ['en.php', 'qw.php'];\n        include('pages/' . (isset($_GET['lang']) ? str_replace('../', '', $_GET['lang']) : $lang[array_rand($lang)]));\n    ?>\n    </body>\n</html>\n"})}),"\n",(0,a.jsx)(t.h3,{id:"analysis",children:"Analysis"}),"\n",(0,a.jsxs)(t.p,{children:["We see\xa0from the PHP file, that the query param ",(0,a.jsx)(t.code,{children:"lang"})," will include a file from the filesystem. Its main use is to provide us with language support by using either ",(0,a.jsx)(t.code,{children:"en.php"})," or ",(0,a.jsx)(t.code,{children:"qw.php"})," as language files, but we see other uses for it - namely ",(0,a.jsx)(t.strong,{children:"local file inclusion"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["The only problem, is that there is a ",(0,a.jsx)(t.code,{children:"str_replace"})," method being called, which removes any string of the form ",(0,a.jsx)(t.code,{children:"../"})," from the query. But we need ",(0,a.jsx)(t.code,{children:"../"})," to get to the root directory, where the flag is."]}),"\n",(0,a.jsx)(t.h3,{id:"solution",children:"Solution"}),"\n",(0,a.jsxs)(t.p,{children:["Since ",(0,a.jsx)(t.code,{children:"str_replace"})," will run through our string only once, all we need to do is supply a buffer to the string ",(0,a.jsx)(t.code,{children:"../"})," by making it for example into ",(0,a.jsx)(t.code,{children:"....//"})," or  ",(0,a.jsx)(t.code,{children:".../...//"}),", or anything similar to that."]}),"\n",(0,a.jsx)(t.p,{children:"So, all we have to do is navigate to the following url"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"http://<vulnerablesite:port>/?lang=....//....//flag\n"})}),"\n",(0,a.jsx)(t.p,{children:"Or, if we want to be cheeky, we can script this by running"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"curl http://<vulnerablesite:port>/?lang=....//....//flag | grep CHTB{.*} --color=none\n"})}),"\n",(0,a.jsx)(t.p,{children:"To directly get our flag as output"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"CHTB{b4d_4li3n_pr0gr4m1ng}\n"})}),"\n","\n","\n",(0,a.jsx)(l.A,{})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},2714:(e,t,n)=>{n.d(t,{A:()=>l});n(6540);const a={"donate-card":"donate-card_mbts",bmac:"bmac_qmhE"};var r=n(4848);function l(){return(0,r.jsx)("div",{className:"alert alert--primary",role:"alert",children:(0,r.jsxs)("div",{className:"card__body",children:[(0,r.jsx)("p",{children:"Thank you for reading!"}),(0,r.jsx)("p",{children:"The information in this blog, as well as all the tools, apps and libraries I develop are currently open source."}),(0,r.jsx)("p",{children:"I would love to keep it this way, and you can help!"}),(0,r.jsx)("p",{children:"You can buy me a coffee from here, which will go towards the next all-nighter I pull off!"}),(0,r.jsx)("a",{href:"https://www.buymeacoffee.com/kblagoev",target:"_blank",children:(0,r.jsx)("img",{src:"https://cdn.buymeacoffee.com/buttons/v2/default-violet.png",className:a.bmac,alt:"Buy Me A Coffee"})}),(0,r.jsxs)("p",{children:["Or you can support me and my code monthly over at ",(0,r.jsx)("a",{href:"https://github.com/sponsors/tihawk",target:"_blank",children:"Github Sponsors!"})]}),(0,r.jsx)("p",{children:"Thanks!"})]})})}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>i});var a=n(6540);const r={},l=a.createContext(r);function s(e){const t=a.useContext(l);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(l.Provider,{value:t},e.children)}}}]);